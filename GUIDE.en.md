# McDis-RCON GUIDE  

## 1. McDis-RCON Setup  

To use McDis-RCON, you need a Discord bot token. If you don‚Äôt have one yet, you can follow this tutorial to create a bot on Discord: [[Official Guide]](https://discordpy.readthedocs.io/en/stable/discord.html).  

It is recommended to grant administrator permissions to the bot to avoid issues when generating and managing the control panel.  

## 2. Console Commands  

### Initialization  

```sh  
mcdis init  
```  
Generates the `md_config.yml` file required to configure McDis-RCON.  

### Execution  

```sh  
mcdis run  
```  
Starts McDis-RCON if a valid `md_config.yml` file is present in the execution folder.  

#### Example output:  

```bash  
Initializing McDis RCON v0.4.19a...  
Your configuration has been loaded successfully.  
[2025-03-13 00:01:36] [INFO    ] discord.client: logging in using static token  
[2025-03-13 00:01:38] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: 8974ae0bce7cc313e57a778b817e3507).  
Logged in as Just Another Bot#6873!  
   ‚Ä¢ Creating objects  
     -> server 1  
     -> server 2  
     -> network 1  
   ‚Ä¢ Loaded Discord events  
   ‚Ä¢ Loaded server panel  
Loading Complete  

Commands: start, stop, restart, kill, mdreload, adreload, status, exit  
>>  
```  

### Process Management  

Once McDis-RCON is running, it will handle the `Ctrl + C` signal, attempting to stop processes using the commands defined in `stop_cmd`.  
If a process takes more than 60 seconds to close, it will be forcibly terminated before the program exits. You can also manage processes directly from the console.

Ahora con esto:

## 3. File Structure

From this point forward, we will refer to the folder where McDis-RCON is executed as `McDis`. Within the program, McDis-RCON also uses this name to refer to this folder.

### Process Folders

When initializing McDis-RCON, specific folders will be created for each defined process. For example:

- `McDis/server 1` ‚Üí Contains all files for the `server 1` process.
- `McDis/server 2` ‚Üí Contains all files for the `server 2` process.
- `McDis/network 1` ‚Üí Contains all files for the `network 1` process.

Within each process folder, additional subfolders will be generated for commands and plugins:

- `McDis/<process>/.mdcommands` ‚Üí Stores predefined commands for `<process>`.
- `McDis/<process>/.mdplugins` ‚Üí Stores plugins associated with `<process>`.

### Folders with Specific Purposes

Additionally, McDis-RCON will generate extra folders with specific purposes:

- `McDis/.mdbackups` ‚Üí Stores all backups generated by McDis-RCON.
- `McDis/.mdaddons` ‚Üí Contains additional addons used by McDis-RCON.

## 4. Panel

Considering a configuration with three servers (`smp`, `cmp`, `mmp`) and one network (`velocity`), the generated panel will look like this:

![McDis-RCON Panel](https://i.imgur.com/lE4GRIV.png)

### Commands

In the threads acting as the process consoles, the following commands can be used:

- `start` ‚Üí Executes the `start_cmd` configured in `md_config.yml`.
- `stop` ‚Üí Executes the `stop_cmd` configured in `md_config.yml`.
- `kill` ‚Üí Forcefully closes the process.
- `restart` ‚Üí Executes `stop_cmd`, and once the process is closed, executes `start_cmd`.
- `mdreload` ‚Üí Reloads the mdplugins inside the `.mdplugins` of the corresponding process.

In the Discord panel channel, these commands should be preceded by `!!` and specify the process or add `-all` to apply it to all. Example:

- `!!start SMP` ‚Üí Equivalent to typing `start` in the `SMP` console. (It is case-insensitive: `!!start smp` will do the same).
- `!!start-all` ‚Üí Equivalent to typing `start` in the console of each process.

There is also the `!!adreload` command, which allows reloading McDis-RCON's addons.

### Buttons

- **`Processes`** ‚Üí Expands controls to manage processes with buttons.

  ![McDis-RCON Processes Panel](https://i.imgur.com/ZYtK5nO.png)

  - `‚¨ÖÔ∏è` ‚Üí Returns to the default interface.
  - The second button allows toggling between processes.
  - The remaining buttons correspond to the respective commands.

- **`Files`** ‚Üí Opens the file manager (detailed in another section).
- **`Tools`** ‚Üí Expands additional tools (detailed in another section).
- **`Guide`** ‚Üí Displays the McDis-RCON guide (not yet implemented).
- **`Restart`** ‚Üí Requests confirmation to restart the program. Before shutting down, it will attempt to stop all processes with `stop_cmd`. If they take more than 60 seconds to close, they will be forcefully terminated and the restart will proceed.

### Customization

To add a banner to the panel, place an image in `McDis/banner.png`. It will be loaded automatically.

üìè **Recommended size:** 515 √ó 131 px  

![Panel Banner](https://i.imgur.com/SgTT90z.png)

## 5. Plugin and Addon System

McDis-RCON allows you to extend its functionality through two distinct systems:  
- **`mdaddons`** ‚Üí These run while McDis-RCON is open.  
- **`mdplugins`** ‚Üí These depend on the corresponding process being running.  

## Addons (`mdaddons`)
These are loaded as soon as McDis-RCON connects to the Discord API and can be reloaded using the `!!adreload` command in the panel channel.

They should be placed inside the `McDis/.mdaddons` folder.

<details>
  <summary>Creating Addons in McDis-RCON</summary>

McDis-RCON allows two ways to create addons:  
1. **Individual files** (`.py`).  
2. **Folders** with a `__init__.py` file inside.  

</details>

<details>
  <summary>How McDis-RCON Loads Addons</summary>  

When the system loads or reloads addons, it looks inside `McDis/.mdaddons` and follows these rules:  

- **`.py` files**: If they contain a class `mdaddon`, an instance of this class is created.  
- **Folders**: If they contain a `__init__.py` file with a class `mdaddon`, an instance of this class is created.  

In both cases, when the class is instantiated, an `McDisClient` object from McDis-RCON is passed as an argument.

</details>

<details>
  <summary>How Addons Interact with Discord Events</summary>  

Addons can react to Discord events. To do this, McDis-RCON checks if instances of `mdaddon` have methods with the same name as the events in `discord.py`. If a match is found, the event will be sent to the addon.  

</details>

<details>
  <summary>Example: Add a Reaction to Panel Messages</summary>

If we want the bot to react to all messages in the panel channel, we can create a script in:  
`McDis/.mdaddons/reactor.py`  

```python
import discord
from mcdis_rcon.classes import McDisClient

class mdaddon:
    def __init__(self, client: McDisClient):
        self.client = client

    async def on_message(self, message: discord.Message):
        if message.author.bot:
            return  # Ignore messages from bots

        if message.channel.id == self.client.panel.id:
            await message.add_reaction('‚úÖ')
```

The `on_message` method follows the same structure as documented in `discord.py`.  
[discord.py Documentation](https://discordpy.readthedocs.io/en/stable/api.html#discord-api-events)  
</details>

<details>
  <summary>Addon Unloading</summary>

Before reloading the addons, McDis-RCON checks if the loaded addons have an `unload` method. This method takes no arguments and allows cleanup actions before reloading.  

```python
from mcdis_rcon.classes import McDisClient

class mdaddon:
    def __init__(self, client: McDisClient):
        self.client = client

    def unload(self):
        # Actions before unloading
        return
```

</details>

## Plugins (`mdplugins`)
These are loaded when the process is initialized and can be reloaded with `!!mdreload` in the panel channel or `mdreload` in the process console.

They should be placed inside the `McDis/<process>/.mdplugins` folder.

<details>
  <summary>Creating Plugins in McDis-RCON</summary>

McDis-RCON allows you to create plugins as individual files (`.py`).  

</details>

<details>
  <summary>How McDis-RCON Loads Plugins</summary>

When the process loads or reloads plugins, it looks inside `McDis/<process>/.mdplugins` and follows these rules:

- **`.py` files**: If they contain a class `mdplugin`, an instance of this class is created.  

When the class is instantiated, an `McDisClient` object from McDis-RCON is passed as an argument.

</details>

<details>
  <summary>How Plugins Interact with Discord Events</summary>

Plugins can react to Discord events. To do this, McDis-RCON checks if instances of `mdplugin` have methods named after the events in `discord.py`, but with the `listener_` prefix. If a match is found, the event will be sent to the plugin.  

</details>

<details>
  <summary>How Plugins Interact with Console Logs</summary>  

Every time McDis-RCON processes a console log, it checks if plugins have a `listener_events` method that takes the log as an argument (a string). If this method is defined, the log will be sent to the plugin, allowing the creation of an event system based on server output.

</details>

<details>
  <summary>Example: Add a Reaction to Panel Messages When SMP Process is Running</summary>

If we want the bot to react to all messages in the panel channel when the SMP process is running, we can create a script in:  
`McDis/SMP/.mdplugins/reactor.py`  

```python
import discord
from mcdis_rcon.classes import McDisClient

class mdplugin:
    def __init__(self, client: McDisClient):
        self.client = client

    async def listener_on_message(self, message: discord.Message):
        if message.author.bot:
            return  # Ignore messages from bots

        if message.channel.id == self.client.panel.id:
            await message.add_reaction('‚úÖ')
```

The `listener_on_message` method follows the same structure as documented in `discord.py`, except the event name includes the `listener_` prefix.  
[discord.py Documentation](https://discordpy.readthedocs.io/en/stable/api.html#discord-api-events)  

</details>

<details>
  <summary>Example: Detect Players Connecting via Logs</summary>

If we want a plugin to detect when a player connects, we can analyze the server logs. Assuming the connection messages are in the format `Player <name> joined the game`, we can write a plugin in:  
`McDis/SMP/.mdplugins/player_tracker.py`  

```python
from mcdis_rcon.classes import McDisClient

class mdplugin:
    def __init__(self, client: McDisClient):
        self.client = client

    def listener_events(self, log: str):
        if "joined the game" in log:
            player_name = log.split(" ")[1]  # Extract player name
            print(f"Player {player_name} has joined.")
```

</details>

<details>
  <summary>Plugin Unloading</summary>

Before reloading the plugins, McDis-RCON checks if the loaded plugins have an `unload` method. This method takes no arguments and allows cleanup actions before reloading.  

```python
from mcdis_rcon.classes import McDisClient

class mdplugin:
    def __init__(self, client: McDisClient):
        self.client = client

    def unload(self):
        # Actions before unloading
        return
```

</details>

## Advanced Examples and Customization  
By default, addons only interact with Discord events, and plugins interact with both Discord events and the process console logs.

However, on servers like Aeternum and Enigma, using addons, a more advanced event system has been implemented. This enables the integration of commands in Minecraft and detection of various in-game actions, expanding the possibilities for automation and customization in server management.

For more details about these implementations, check out:  
- [AeternumBot](https://github.com/mjpr-3435/AeternumBot)  
- EnigmaBot (Coming soon)


## 6. File Manager

McDis-RCON includes a file manager that allows you to navigate within `McDis`. By pressing the `Files` button in the panel, an interface like this will appear:

![File Manager](https://i.imgur.com/PcJ5afz.png)

### Interface Controls

- **`‚¨ÖÔ∏è`** ‚Üí Go back to the previous folder.
- **`üîÑ`** ‚Üí Reload the interface.
- **`üìå`** ‚Üí Allows you to enter a specific path.
- **`Terminal`** ‚Üí Allows advanced file management operations.
- **`Dropdown`** ‚Üí Displays the first 25 options in the current folder and facilitates navigation. In folders with more than 25 files, it is recommended to use the terminal.

### Files

When a file is selected instead of a folder, the `Request`, `Edit`, and `Delete` buttons appear:

![Files](https://i.imgur.com/5tPw9DQ.png)

- **`‚¨ÖÔ∏è`** ‚Üí Go back to the previous folder.
- **`üîÑ`** ‚Üí Reload the interface.
- **`Request`** ‚Üí Requests the file for download, with a 5MB limit due to Discord restrictions.
- **`Edit`** ‚Üí Allows renaming the file.
- **`Delete`** ‚Üí Deletes the file.

For larger files, Flask can be used (explained later).

### Text File Editor

If the file is a text file, McDis-RCON will show a preview of the content (up to 1024 characters).

![Text Preview](https://i.imgur.com/dSeIQg7.png)

If the file has fewer than 4000 characters, it can also be edited directly.

![Text Edit](https://i.imgur.com/ZV1NlQx.png)

### Commands

All process folders contain a subfolder `.mdcommands`, where predefined commands are stored in `.yml` format. When accessing this folder, an interface like the following will appear:

![Commands](https://i.imgur.com/5r3AMUI.png)

- **`‚¨ÖÔ∏è`** ‚Üí Go back to the previous folder.
- **`üîÑ`** ‚Üí Reload the interface.
- **`üì¶`** ‚Üí Show the file interface.
- **`Dropdown`** ‚Üí Displays all defined commands and allows creating new ones.

On servers like Aeternum SMP, specific commands have been defined to automate tasks like the MobSwitch. Each command can have multiple predefined actions, such as `Reset`, `Over`, and `Nether`.

![Commands MobSwitch](https://i.imgur.com/5KCcmi2.png)

- **`‚¨ÖÔ∏è`** ‚Üí Go back to the `.mdcommands` interface.
- **`üîÑ`** ‚Üí Switch between different command actions.
- **`Execute`** ‚Üí Executes the command in the process console.
- **`Edit`** ‚Üí Opens the `.yml` file for editing.
- **`Delete`** ‚Üí Deletes the command.
- **`Dropdown`** ‚Üí Displays all actions defined for the selected command.

### Backups

By navigating to `McDis/.mdbackups`, you will find folders with the names of the configured processes. Entering one of them will show an interface like this:

![Backups](https://i.imgur.com/seit7kJ.png)

- **`‚¨ÖÔ∏è`** ‚Üí Go back to the previous folder.
- **`üîÑ`** ‚Üí Reload the interface.
- **`üì¶`** ‚Üí Show the file interface.

If backups have already been created, they will appear in the list. To create a new backup, select the corresponding option in the dropdown. McDis-RCON will ask you to close the process before proceeding to avoid issues.

The backup system automatically deletes older backups according to the limit defined in `md_config.yml`.

### Terminal

In addition to the graphical interface, McDis-RCON features an integrated terminal that allows advanced operations within the file manager, such as navigating between folders, editing files, renaming, copying, moving, creating new folders, deleting, compressing folders, etc. (all within `McDis`).

![Terminal](https://i.imgur.com/xgPt5hs.png)


## 7. Tools  
By pressing the `Tools` button in the panel, the following options will appear:

![Tools](https://i.imgur.com/S3jAKbE.png)

### Processes  
Allows you to view all the processes running within the `McDis` folder. If you select a process from the dropdown, McDis-RCON will forcefully close it.

![Processes](https://i.imgur.com/72K5lBN.png)

- **`üîÑ`** ‚Üí Reload the interface.
- **`üìå`** ‚Üí Allows you to enter a specific path.

### Uploader  
The Uploader allows you to upload files through the panel's channel. When activated, any file sent to the channel will be saved to the configured path. It also provides the option to decide whether to overwrite existing files or not.

![Uploader](https://i.imgur.com/hL2tnDv.png)

- **`üîÑ`** ‚Üí Reload the interface.
- **`üìå`** ‚Üí Allows you to enter a specific path for uploading files.
- **`Run/Close`** ‚Üí Defines the state of the Uploader.
- **`Do Not Overwrite/Overwrite`** ‚Üí Defines whether the Uploader should overwrite existing files.

### Flask  
McDis-RCON incorporates a small Flask server to facilitate downloading files that exceed the 5 MB limit imposed by Discord. To use this feature, a port must be opened to allow traffic.

To download a file, navigate to it and click `Request`. If `Flask: Allow` is activated in the settings, a download link will be generated. You can choose whether the links should be single-use and/or temporary. The configured IP must be public, not internal. Additionally, in the `Console Flask` thread, details such as who requested the file, when it was used, and whether it expired will be logged.

![Flask](https://i.imgur.com/G1K8gP2.png)

- **`üîÑ`** ‚Üí Reload the interface.
- **`Run/Close`** ‚Üí Defines the state of the Flask server.
- **`Single Use/Multi-Use`** ‚Üí Defines whether the generated links should be single-use or multi-use.
- **`Temporary/Persistent`** ‚Üí Defines whether the generated links should be temporary or persistent.

## 8. Errors  
If an error occurs during the execution of events or functions, McDis will automatically generate a report in the `Error reports` thread of the panel's channel. Additionally, if the error is related to a running process, a reference will be logged in its console.

![Error Reports](https://i.imgur.com/ysDyQdU.png)
